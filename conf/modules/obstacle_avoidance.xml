<!DOCTYPE module SYSTEM "module.dtd">

<module name="obstacle_avoidance" dir="computer_vision/obstacle_avoidance">
  <doc>
    <description>
      Video ARDone 2 Front Camera Obstacle Avoidance
      
      The module uses a color counter to detect specific coloured obstacles
      Additionally a opticflow script is used to detect generic obstacles, containing:
          FAST9 corner detection
	  Lucas Kanade corner tracking
	  Linear polyfit on tracked corners and their flow
	  Correlation of tracked corners and their flow
	  
      A downlink option is included in obtacle_avoidance.c and opticflow_calculator.c, also drawing the corners and their flow.
      The downlink uses the udp-stream via a jpeg image format
    </description>
  </doc>

  <header>
    <file name="obstacle_avoidance.h"/>
  </header>

  <init fun="obstacle_avoidance_init()"/>
  <periodic fun="obstacle_avoidance_run()" start="obstacle_avoidance_start()" stop="obstacle_avoidance_stop()" autorun="TRUE"/>
  <makefile target="ap">
    <!-- Main vision code /-->
    <file name="obstacle_avoidance.c"/> <!-- Main vision module /-->
    <file name="opticflow_calculator.c"/> <!-- Opticflow function /-->
    <file name="color_count.c"/> <!-- Color count function /-->

    <!-- Video downlink code /-->
    <file name="socket.c" dir="modules/computer_vision/lib/udp"/>
    <file name="v4l2.c" dir="modules/computer_vision/lib/v4l"/>
    <file name="jpeg.c" dir="modules/computer_vision/lib/encoding"/>
    <file name="rtp.c" dir="modules/computer_vision/lib/encoding"/>

    <!-- Vision support for Opticflow function and Video downlink -->
    <file name="image.c" dir="modules/computer_vision/lib/vision"/>
    <file name="fastRosten.c" dir="modules/computer_vision/lib/vision"/>
    <file name="lucas_kanade.c" dir="modules/computer_vision/lib/vision"/>

    <!-- Mathematical support functions for Opticflow function/-->
    <file name="pprz_matrix_decomp_float.c" dir="math"/>
    <file name="pprz_polyfit_float.c" dir="math"/>
    <file name="pprz_correlation.c" dir="math"/>

    <!-- Include relevant folders and flags /-->
    <define name="modules/computer_vision/lib" type="include"/>
    <define name="math" type="include"/>
    <define name="pthread" type="raw"/>
    <define name="__USE_GNU"/>
    <flag name="LDFLAGS" value="pthread"/>
    <flag name="LDFLAGS" value="lrt"/>
    <flag name="LDFLAGS" value="static"/>
  </makefile>
</module>
